---
title: Eseguire la migrazione da ASP.NET Core 3,1 a 5,0
author: scottaddie
description: Informazioni su come eseguire la migrazione di un progetto ASP.NET Core 3,1 ASP.NET Core 5,0.
ms.author: scaddie
ms.custom: mvc
ms.date: 12/02/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: 1a4dcdee738eb05f62c3268d9ef579974dd99cf4
ms.sourcegitcommit: b64c44ba5e3abb4ad4d50de93b7e282bf0f251e4
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "97972093"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="323f8-103">Eseguire la migrazione da ASP.NET Core 3,1 a 5,0</span><span class="sxs-lookup"><span data-stu-id="323f8-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="323f8-104">Di [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="323f8-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="323f8-105">Questo articolo illustra come aggiornare un progetto di ASP.NET Core 3,1 esistente a ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="323f8-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="323f8-106">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="323f8-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="323f8-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="323f8-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="323f8-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="323f8-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="323f8-109">Visual Studio per Mac</span><span class="sxs-lookup"><span data-stu-id="323f8-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="323f8-110">Aggiornare la versione di .NET Core SDK in global.json</span><span class="sxs-lookup"><span data-stu-id="323f8-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="323f8-111">Se si fa affidamento [ su unglobal.jsnel](/dotnet/core/tools/global-json) file per fare riferimento a una versione specifica di .NET Core SDK, aggiornare la `version` proprietà alla versione .NET 5,0 SDK installata.</span><span class="sxs-lookup"><span data-stu-id="323f8-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="323f8-112">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="323f8-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="323f8-113">Aggiornare il Framework di destinazione</span><span class="sxs-lookup"><span data-stu-id="323f8-113">Update the target framework</span></span>

<span data-ttu-id="323f8-114">Se si aggiorna un Blazor WebAssembly progetto, passare alla sezione [Update Blazor WebAssembly Projects (progetti di aggiornamento](#update-blazor-webassembly-projects) ).</span><span class="sxs-lookup"><span data-stu-id="323f8-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="323f8-115">Per qualsiasi altro tipo di progetto ASP.NET Core, aggiornare il moniker del Framework di destinazione del file di progetto [(TFM)](/dotnet/standard/frameworks) in `net5.0` :</span><span class="sxs-lookup"><span data-stu-id="323f8-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

## <a name="changes-to-no-locblazor-app-routing-logic-in-501"></a><span data-ttu-id="323f8-116">Modifiche alla Blazor logica di routing delle app in 5.0.1</span><span class="sxs-lookup"><span data-stu-id="323f8-116">Changes to Blazor app routing logic in 5.0.1</span></span>

<span data-ttu-id="323f8-117">Il calcolo della precedenza della route è stato modificato nella versione patch di ASP.NET Core 5.0.1.</span><span class="sxs-lookup"><span data-stu-id="323f8-117">The computation of route precedence changed in the ASP.NET Core 5.0.1 patch release.</span></span> <span data-ttu-id="323f8-118">Questo potrebbe interessare l'utente se sono state definite route catch-all o route con parametri facoltativi.</span><span class="sxs-lookup"><span data-stu-id="323f8-118">This might affect you if you've defined catch-all routes or routes with optional parameters.</span></span>

### <a name="old-behavior"></a><span data-ttu-id="323f8-119">Comportamento precedente</span><span class="sxs-lookup"><span data-stu-id="323f8-119">Old behavior</span></span>

<span data-ttu-id="323f8-120">Con il comportamento precedente in ASP.NET Core 5.0.0 o versioni precedenti, le route con precedenza inferiore, ad esempio `{*slug}` , vengono confrontate prima delle route con precedenza maggiore, ad esempio `/customer/{id}` .</span><span class="sxs-lookup"><span data-stu-id="323f8-120">With the prior behavior in ASP.NET Core 5.0.0 or earlier, routes with lower precedence, such as `{*slug}`, are matched before routes with higher precedence, such as `/customer/{id}`.</span></span>

### <a name="new-behavior"></a><span data-ttu-id="323f8-121">Nuovo comportamento</span><span class="sxs-lookup"><span data-stu-id="323f8-121">New behavior</span></span>

<span data-ttu-id="323f8-122">Il nuovo comportamento in ASP.NET Core 5.0.1 o versione successiva corrisponde maggiormente al comportamento di routing definito nelle app ASP.NET Core, in cui il Framework calcola e stabilisce la precedenza della route per ogni segmento e usa solo la lunghezza della route per interrompere i vincoli come criteri secondari.</span><span class="sxs-lookup"><span data-stu-id="323f8-122">The new behavior in ASP.NET Core 5.0.1 or later more closely matches the routing behavior defined in ASP.NET Core apps, where the framework computes and establishes the route precedence for each segment first and only uses the length of the route to break ties as a secondary criteria.</span></span>

### <a name="reason-for-change"></a><span data-ttu-id="323f8-123">Motivo della modifica</span><span class="sxs-lookup"><span data-stu-id="323f8-123">Reason for change</span></span>

<span data-ttu-id="323f8-124">Il comportamento originale viene considerato un bug nell'implementazione, perché l'obiettivo è che il Blazor sistema di routing si comporti allo stesso modo del sistema di routing ASP.NET Core per il subset di funzionalità supportate dal Blazor routing.</span><span class="sxs-lookup"><span data-stu-id="323f8-124">The original behavior is considered a bug in the implementation because our goal is for the Blazor routing system to behave in the same way as the ASP.NET Core routing system for the subset of features supported by Blazor routing.</span></span>

### <a name="recommended-action"></a><span data-ttu-id="323f8-125">Azione consigliata</span><span class="sxs-lookup"><span data-stu-id="323f8-125">Recommended action</span></span>

<span data-ttu-id="323f8-126">Aggiungere l' `PreferExactMatches` attributo al `Router` componente nel `App.razor` file per scegliere il comportamento corretto:</span><span class="sxs-lookup"><span data-stu-id="323f8-126">Add the `PreferExactMatches` attribute to the `Router` component in the `App.razor` file to opt into the correct behavior:</span></span>

```razor
<Router AppAssembly="@typeof(Program).Assembly" PreferExactMatches="@true">
```

<span data-ttu-id="323f8-127">Quando `PreferExactMatches` è impostato su `@true` , la corrispondenza delle route preferisce corrispondenze esatte rispetto ai caratteri jolly.</span><span class="sxs-lookup"><span data-stu-id="323f8-127">When `PreferExactMatches` is set to `@true`, route matching prefers exact matches over wildcards.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="323f8-128">Tutte le app devono impostare in modo esplicito `PreferExactMatches` su `@true` .</span><span class="sxs-lookup"><span data-stu-id="323f8-128">All apps should explicitly set `PreferExactMatches` to `@true`.</span></span>
>
> <span data-ttu-id="323f8-129">La possibilità di impostare `PreferExactMatches` su `@false` o lasciarla non annullata, per impostazione predefinita l'opzione su `false` in C#, *viene fornita solo per compatibilità con le versioni precedenti*.</span><span class="sxs-lookup"><span data-stu-id="323f8-129">The ability to set `PreferExactMatches` to `@false` or leave it unset, which defaults the option to `false` in C#, *is only provided for backward compatibility*.</span></span>
>
> <span data-ttu-id="323f8-130">Quando viene rilasciato .NET 6, il router preferisce sempre le corrispondenze esatte e l' `PreferExactMatches` opzione non sarà disponibile.</span><span class="sxs-lookup"><span data-stu-id="323f8-130">When .NET 6 is released, the router will always prefer exact matches, and the `PreferExactMatches` option won't be available.</span></span>

## <a name="update-no-locblazor-webassembly-and-no-locblazor-server-projects"></a><span data-ttu-id="323f8-131">Aggiornamento Blazor WebAssembly e Blazor Server progetti</span><span class="sxs-lookup"><span data-stu-id="323f8-131">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="323f8-132">*Le indicazioni fornite in questa sezione si applicano a entrambi i Blazor modelli di hosting. Le sezioni che seguono questa sezione forniscono indicazioni aggiuntive specifiche per l'hosting di modelli e tipi di app. Applicare le linee guida da tutte le sezioni pertinenti all'app.*</span><span class="sxs-lookup"><span data-stu-id="323f8-132">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidance from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="323f8-133">In `wwwroot/index.html` di un' Blazor WebAssembly app o `Pages/_Host.cshtml` di un' Blazor Server app, aggiungere un `<link>` elemento all' `<head>` elemento per gli stili.</span><span class="sxs-lookup"><span data-stu-id="323f8-133">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="323f8-134">Nei valori dell' `<link>` attributo dell'elemento seguenti `href` , il segnaposto `{ASSEMBLY NAME}` è il nome dell'assembly dell'app.</span><span class="sxs-lookup"><span data-stu-id="323f8-134">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```
    
    <span data-ttu-id="323f8-135">Autonomo Blazor WebAssembly o Blazor Server esempio:</span><span class="sxs-lookup"><span data-stu-id="323f8-135">Standalone Blazor WebAssembly or Blazor Server example:</span></span>
    
    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="323f8-136">*`Client`* progetto di un esempio di soluzione ospitata Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="323f8-136">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>
    
    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="323f8-137">Includere un nuovo spazio dei nomi nel file dell'app `_Imports.razor` per la [virtualizzazione dei componenti](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="323f8-137">Include a new namespace in the app's `_Imports.razor` file for [component virtualization](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName>.</span></span> <span data-ttu-id="323f8-138">I `_Imports.razor` file seguenti mostrano gli spazi dei nomi predefiniti nelle app generate dai Blazor modelli di progetto.</span><span class="sxs-lookup"><span data-stu-id="323f8-138">The following `_Imports.razor` files show the default namespaces in apps generated from the Blazor project templates.</span></span> <span data-ttu-id="323f8-139">Il segnaposto `{ASSEMBLY NAME}` è il nome dell'assembly dell'app.</span><span class="sxs-lookup"><span data-stu-id="323f8-139">The placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

   <span data-ttu-id="323f8-140">Blazor WebAssembly (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="323f8-140">Blazor WebAssembly (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using System.Net.Http.Json
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.AspNetCore.Components.WebAssembly.Http
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```

   <span data-ttu-id="323f8-141">Blazor Server (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="323f8-141">Blazor Server (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using Microsoft.AspNetCore.Authorization
   @using Microsoft.AspNetCore.Components.Authorization
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```
   
1. <span data-ttu-id="323f8-142">Nel `MainLayout` componente ( `Shared/MainLayout.razor` ) racchiudere il markup HTML del componente con un `<div>` elemento con un `class` attributo impostato su `page` :</span><span class="sxs-lookup"><span data-stu-id="323f8-142">In the `MainLayout` component (`Shared/MainLayout.razor`), surround the component's HTML markup with a `<div>` element that has a `class` attribute set to `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="323f8-143">Aggiungere i file seguenti alla `Shared` cartella:</span><span class="sxs-lookup"><span data-stu-id="323f8-143">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="323f8-144">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="323f8-144">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="323f8-145">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="323f8-145">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="323f8-146">Il file di base più recente `wwwroot/css/app.css` di un' Blazor WebAssembly app o `wwwroot/css/site.css` di un file di un' Blazor Server app include gli stili seguenti.</span><span class="sxs-lookup"><span data-stu-id="323f8-146">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="323f8-147">Rimuovere gli stili aggiuntivi lasciando gli stili seguenti e quelli aggiunti all'app.</span><span class="sxs-lookup"><span data-stu-id="323f8-147">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="323f8-148">Il foglio di stile seguente include solo gli stili di base e **non include gli** stili personalizzati aggiunti dallo sviluppatore:</span><span class="sxs-lookup"><span data-stu-id="323f8-148">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-no-locblazor-webassembly-projects"></a><span data-ttu-id="323f8-149">Aggiornare i Blazor WebAssembly progetti</span><span class="sxs-lookup"><span data-stu-id="323f8-149">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="323f8-150">Seguire le istruzioni riportate nella sezione precedente [aggiornamento Blazor WebAssembly e Blazor Server progetti](#update-blazor-webassembly-and-blazor-server-projects) .</span><span class="sxs-lookup"><span data-stu-id="323f8-150">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) section.</span></span>

<span data-ttu-id="323f8-151">Per un Blazor WebAssembly progetto, incluso il *`Client`* progetto di una soluzione ospitata Blazor , applicare le seguenti modifiche al file di progetto:</span><span class="sxs-lookup"><span data-stu-id="323f8-151">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="323f8-152">Aggiornare l'SDK da `Microsoft.NET.Sdk.Web` a `Microsoft.NET.Sdk.BlazorWebAssembly` :</span><span class="sxs-lookup"><span data-stu-id="323f8-152">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="323f8-153">Questo aggiornamento si applica solo ai Blazor WebAssembly progetti autonomi e ai *`Client`* progetti di soluzioni ospitate Blazor .</span><span class="sxs-lookup"><span data-stu-id="323f8-153">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="323f8-154">Aggiornare le proprietà seguenti:</span><span class="sxs-lookup"><span data-stu-id="323f8-154">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="323f8-155">Rimuovere il riferimento al pacchetto in [Microsoft. AspNetCore. Components. webassembly. Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="323f8-155">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="323f8-156">Aggiornare gli altri pacchetti alle versioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="323f8-156">Update other packages to their latest versions.</span></span> <span data-ttu-id="323f8-157">Le versioni più recenti sono reperibili in [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="323f8-157">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="323f8-158">In `wwwroot/index.html` modificare l'elemento che carica il `App` componente in un `<div>` elemento con `id` impostato su `app` :</span><span class="sxs-lookup"><span data-stu-id="323f8-158">In `wwwroot/index.html`, change the element that loads the `App` component to a `<div>` element with an `id` set to `app`:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<div id="app">Loading...</div>
    ```
    
1. <span data-ttu-id="323f8-159">In `Program.Main` ( `Program.cs` ):</span><span class="sxs-lookup"><span data-stu-id="323f8-159">In `Program.Main` (`Program.cs`):</span></span>

   * <span data-ttu-id="323f8-160">Modificare il riferimento all' `<app>` elemento in un selettore CSS aggiungendovi un hash `#` .</span><span class="sxs-lookup"><span data-stu-id="323f8-160">Change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it.</span></span>
   * <span data-ttu-id="323f8-161">Modificare la `HttpClient` registrazione in ambito.</span><span class="sxs-lookup"><span data-stu-id="323f8-161">Change the `HttpClient` registration to scoped.</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    
    -builder.Services.AddTransient(sp => new HttpClient 
    -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    +builder.Services.AddScoped(sp => new HttpClient 
    +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    ```

### <a name="standalone-no-locblazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="323f8-162">App autonoma Blazor WebAssembly con account Microsoft</span><span class="sxs-lookup"><span data-stu-id="323f8-162">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="323f8-163">Seguire le istruzioni riportate nelle sezioni precedente [aggiornamento Blazor WebAssembly e Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) progetti di [aggiornamento e Blazor WebAssembly progetti](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="323f8-163">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="323f8-164">Per un'app autonoma Blazor WebAssembly registrata nella portale di Azure per usare Azure Active Directory (AAD) per gli account Microsoft:</span><span class="sxs-lookup"><span data-stu-id="323f8-164">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="323f8-165">L'app richiede gli `openid` `offline_access` ambiti e:</span><span class="sxs-lookup"><span data-stu-id="323f8-165">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="323f8-166">Nel pannello portale di Azure **autenticazione** per la registrazione dell'app:</span><span class="sxs-lookup"><span data-stu-id="323f8-166">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="323f8-167">Rimuovere la configurazione della piattaforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="323f8-167">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="323f8-168">Aggiungere una configurazione della piattaforma **applicativa a pagina singola** con l'URI di reindirizzamento dell'app.</span><span class="sxs-lookup"><span data-stu-id="323f8-168">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="323f8-169">Disabilitare la **concessione implicita** per i **token di accesso** e i **token ID**.</span><span class="sxs-lookup"><span data-stu-id="323f8-169">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="323f8-170">Per altre informazioni, vedere <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span><span class="sxs-lookup"><span data-stu-id="323f8-170">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="323f8-171">App autonoma Blazor WebAssembly con Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="323f8-171">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="323f8-172">Seguire le istruzioni riportate nelle sezioni precedente [aggiornamento Blazor WebAssembly e Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) progetti di [aggiornamento e Blazor WebAssembly progetti](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="323f8-172">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="323f8-173">Per un'app autonoma Blazor WebAssembly registrata nella portale di Azure per l'uso di Azure Active Directory (AAD):</span><span class="sxs-lookup"><span data-stu-id="323f8-173">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="323f8-174">L'app richiede l' `https://graph.microsoft.com/User.Read` ambito:</span><span class="sxs-lookup"><span data-stu-id="323f8-174">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="323f8-175">Nel pannello portale di Azure **autenticazione** per la registrazione dell'app:</span><span class="sxs-lookup"><span data-stu-id="323f8-175">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="323f8-176">Rimuovere la configurazione della piattaforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="323f8-176">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="323f8-177">Aggiungere una configurazione della piattaforma **applicativa a pagina singola** con l'URI di reindirizzamento dell'app.</span><span class="sxs-lookup"><span data-stu-id="323f8-177">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="323f8-178">Disabilitare la **concessione implicita** per i **token di accesso** e i **token ID**.</span><span class="sxs-lookup"><span data-stu-id="323f8-178">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="323f8-179">Per altre informazioni, vedere <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span><span class="sxs-lookup"><span data-stu-id="323f8-179">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="323f8-180">App autonoma Blazor WebAssembly con Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="323f8-180">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="323f8-181">Seguire le istruzioni riportate nelle sezioni precedente [aggiornamento Blazor WebAssembly e Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) progetti di [aggiornamento e Blazor WebAssembly progetti](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="323f8-181">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="323f8-182">Per un'app autonoma Blazor WebAssembly registrata nella portale di Azure per usare Azure Active Directory (AAD) B2C:</span><span class="sxs-lookup"><span data-stu-id="323f8-182">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="323f8-183">L'app richiede gli `openid` `offline_access` ambiti e:</span><span class="sxs-lookup"><span data-stu-id="323f8-183">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="323f8-184">Nel pannello portale di Azure **autenticazione** per la registrazione dell'app:</span><span class="sxs-lookup"><span data-stu-id="323f8-184">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="323f8-185">Rimuovere la configurazione della piattaforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="323f8-185">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="323f8-186">Aggiungere una configurazione della piattaforma **applicativa a pagina singola** con l'URI di reindirizzamento dell'app.</span><span class="sxs-lookup"><span data-stu-id="323f8-186">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="323f8-187">Disabilitare la **concessione implicita** per i **token di accesso** e i **token ID**.</span><span class="sxs-lookup"><span data-stu-id="323f8-187">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="323f8-188">Per altre informazioni, vedere <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span><span class="sxs-lookup"><span data-stu-id="323f8-188">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-no-locblazor-webassembly-app-with-azure-active-directory-aad-or-aad-b2c"></a><span data-ttu-id="323f8-189">App ospitata Blazor WebAssembly con Azure Active Directory (AAD) o AAD B2C</span><span class="sxs-lookup"><span data-stu-id="323f8-189">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or AAD B2C</span></span>

<span data-ttu-id="323f8-190">Seguire le istruzioni riportate nelle sezioni precedente [aggiornamento Blazor WebAssembly e Blazor Server ](#update-blazor-webassembly-and-blazor-server-projects) progetti di [aggiornamento e Blazor WebAssembly progetti](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="323f8-190">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="323f8-191">La *`Client`* registrazione dell'app di una Blazor soluzione ospitata che usa AAD o AAD B2C per l'autenticazione utente deve usare una configurazione della piattaforma per le app di Azure a **pagina singola** .</span><span class="sxs-lookup"><span data-stu-id="323f8-191">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration.</span></span>

<span data-ttu-id="323f8-192">Nel pannello portale di Azure *`Client`* **autenticazione** per la registrazione dell'app:</span><span class="sxs-lookup"><span data-stu-id="323f8-192">In the Azure portal *`Client`* app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="323f8-193">Rimuovere la configurazione della piattaforma **Web** .</span><span class="sxs-lookup"><span data-stu-id="323f8-193">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="323f8-194">Aggiungere una configurazione della piattaforma **applicativa a pagina singola** con l'URI di reindirizzamento dell'app.</span><span class="sxs-lookup"><span data-stu-id="323f8-194">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="323f8-195">Disabilitare la **concessione implicita** per i **token di accesso** e i **token ID**.</span><span class="sxs-lookup"><span data-stu-id="323f8-195">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="323f8-196">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="323f8-196">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-no-locblazor-solution"></a><span data-ttu-id="323f8-197">Aggiornare il progetto server di una soluzione ospitata Blazor</span><span class="sxs-lookup"><span data-stu-id="323f8-197">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="323f8-198">Seguire le istruzioni riportate nelle sezioni precedenti:</span><span class="sxs-lookup"><span data-stu-id="323f8-198">Follow the guidance in the preceding sections:</span></span>

* [<span data-ttu-id="323f8-199">Aggiornamento Blazor WebAssembly e Blazor Server progetti</span><span class="sxs-lookup"><span data-stu-id="323f8-199">Update Blazor WebAssembly and Blazor Server projects</span></span>](#update-blazor-webassembly-and-blazor-server-projects)
* [<span data-ttu-id="323f8-200">Aggiornare i Blazor WebAssembly progetti</span><span class="sxs-lookup"><span data-stu-id="323f8-200">Update Blazor WebAssembly projects</span></span>](#update-blazor-webassembly-projects)
* <span data-ttu-id="323f8-201">La sezione che si applica al provider dell'app con Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="323f8-201">The section that applies to the app's provider with Azure Active Directory:</span></span>
  * [<span data-ttu-id="323f8-202">App autonoma Blazor WebAssembly con account Microsoft</span><span class="sxs-lookup"><span data-stu-id="323f8-202">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>](#standalone-blazor-webassembly-app-with-microsoft-accounts)
  * [<span data-ttu-id="323f8-203">App autonoma Blazor WebAssembly con Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="323f8-203">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad)
  * [<span data-ttu-id="323f8-204">App autonoma Blazor WebAssembly con Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="323f8-204">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad-b2c)

<span data-ttu-id="323f8-205">Aggiornare il *`Server`* progetto di una soluzione ospitata Blazor come app ASP.NET Core seguendo le indicazioni generali fornite in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="323f8-205">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="323f8-206">Inoltre, i *`Server`* progetti che autenticano gli utenti nelle Blazor WebAssembly app client con Azure Active Directory (AAD) o B2C devono adottare i nuovi pacchetti Microsoft Identity v 2.0:</span><span class="sxs-lookup"><span data-stu-id="323f8-206">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="323f8-207">Per AAD:</span><span class="sxs-lookup"><span data-stu-id="323f8-207">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="323f8-208">Per AAD B2C:</span><span class="sxs-lookup"><span data-stu-id="323f8-208">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="323f8-209">Per i riferimenti ai pacchetti precedenti, determinare le versioni del pacchetto per i `{VERSION}` segnaposto in NuGet.org:</span><span class="sxs-lookup"><span data-stu-id="323f8-209">For the preceding package references, determine the package versions for the `{VERSION}` placeholders at NuGet.org:</span></span>

* [`Microsoft.Identity.Web`](https://www.nuget.org/packages/Microsoft.Identity.Web)
* [`Microsoft.Identity.Web.UI`](https://www.nuget.org/packages/Microsoft.Identity.Web.UI)

> [!NOTE]
> <span data-ttu-id="323f8-210">L'SDK del *`Server`* progetto in una soluzione ospitata Blazor WebAssembly rimane `Microsoft.NET.Sdk.Web` :</span><span class="sxs-lookup"><span data-stu-id="323f8-210">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="323f8-211">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="323f8-211">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="clean-and-rebuild-the-solution"></a><span data-ttu-id="323f8-212">Pulire e ricompilare la soluzione</span><span class="sxs-lookup"><span data-stu-id="323f8-212">Clean and rebuild the solution</span></span>

<span data-ttu-id="323f8-213">Dopo la migrazione dell'app o della soluzione a .NET 5, pulire e ricompilare l'app o la soluzione.</span><span class="sxs-lookup"><span data-stu-id="323f8-213">After migrating the app or solution to .NET 5, clean and rebuild the app or solution.</span></span> <span data-ttu-id="323f8-214">Se sono presenti incompatibilità dei pacchetti tra i nuovi riferimenti ai pacchetti e i pacchetti memorizzati nella cache:</span><span class="sxs-lookup"><span data-stu-id="323f8-214">If package incompatibilities exist between new package references and cached packages:</span></span>

1. <span data-ttu-id="323f8-215">Cancellare le cache dei pacchetti NuGet eseguendo il comando seguente [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) in una shell dei comandi:</span><span class="sxs-lookup"><span data-stu-id="323f8-215">Clear NuGet package caches by executing the following [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) command in a command shell:</span></span>

   ```dotnetcli
   dotnet nuget locals --clear all
   ```
   
1. <span data-ttu-id="323f8-216">Pulire e ricompilare l'app o la soluzione.</span><span class="sxs-lookup"><span data-stu-id="323f8-216">Clean and rebuild the app or solution.</span></span>

### <a name="troubleshoot"></a><span data-ttu-id="323f8-217">Risolvere problemi</span><span class="sxs-lookup"><span data-stu-id="323f8-217">Troubleshoot</span></span>

<span data-ttu-id="323f8-218">Seguire le indicazioni per la *risoluzione dei problemi* alla fine dell' Blazor WebAssembly argomento relativo alla sicurezza applicabile all'app:</span><span class="sxs-lookup"><span data-stu-id="323f8-218">Follow the *Troubleshoot* guidance at the end of the Blazor WebAssembly security topic that applies to your app:</span></span>

<span data-ttu-id="323f8-219">App autonome Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="323f8-219">Standalone Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="323f8-220">Linee guida generali per i provider OIDC e la libreria di autenticazione webassembly</span><span class="sxs-lookup"><span data-stu-id="323f8-220">General guidance for OIDC providers and the WebAssembly Authentication Library</span></span>](xref:blazor/security/webassembly/standalone-with-authentication-library)
* [<span data-ttu-id="323f8-221">Account Microsoft</span><span class="sxs-lookup"><span data-stu-id="323f8-221">Microsoft Accounts</span></span>](xref:blazor/security/webassembly/standalone-with-microsoft-accounts)
* [<span data-ttu-id="323f8-222">Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="323f8-222">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory)
* [<span data-ttu-id="323f8-223">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="323f8-223">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c)

<span data-ttu-id="323f8-224">App ospitate Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="323f8-224">Hosted Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="323f8-225">Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="323f8-225">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory)
* [<span data-ttu-id="323f8-226">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="323f8-226">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c)
* [<span data-ttu-id="323f8-227">Identity Server</span><span class="sxs-lookup"><span data-stu-id="323f8-227">Identity Server</span></span>](xref:blazor/security/webassembly/hosted-with-identity-server)

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="323f8-228">Client non autorizzato per Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="323f8-228">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="323f8-229">Dopo l'aggiornamento di un' Blazor WebAssembly app che usa AAD per l'autenticazione, è possibile che venga visualizzato l'errore seguente nel callback di accesso all'app dopo che l'utente accede con AAD:</span><span class="sxs-lookup"><span data-stu-id="323f8-229">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="323f8-230">Info: autorizzazione Microsoft. AspNetCore. Authorization. DefaultAuthorizationService [2] non riuscita.</span><span class="sxs-lookup"><span data-stu-id="323f8-230">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="323f8-231">Questi requisiti non sono soddisfatti: DenyAnonymousAuthorizationRequirement: richiede un utente autenticato.</span><span class="sxs-lookup"><span data-stu-id="323f8-231">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="323f8-232">Errore di callback di accesso da AAD:</span><span class="sxs-lookup"><span data-stu-id="323f8-232">Login callback error from AAD:</span></span>

* <span data-ttu-id="323f8-233">Errore: `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="323f8-233">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="323f8-234">Descrizione `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="323f8-234">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="323f8-235">Per risolvere l'errore:</span><span class="sxs-lookup"><span data-stu-id="323f8-235">To resolve the error:</span></span>

1. <span data-ttu-id="323f8-236">Nel portale di Azure accedere al manifesto dell' [app](/azure/active-directory/develop/reference-app-manifest).</span><span class="sxs-lookup"><span data-stu-id="323f8-236">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="323f8-237">Impostare l' [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attributo su `null` o su `true` .</span><span class="sxs-lookup"><span data-stu-id="323f8-237">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-a-no-locblazor-progressive-web-application-pwa"></a><span data-ttu-id="323f8-238">Aggiornare un' Blazor applicazione Web progressiva (PWA)</span><span class="sxs-lookup"><span data-stu-id="323f8-238">Update a Blazor Progressive Web Application (PWA)</span></span>

<span data-ttu-id="323f8-239">Aggiungere il seguente elemento al file di progetto dell'app PWA:</span><span class="sxs-lookup"><span data-stu-id="323f8-239">Add the following item to the PWA app's project file:</span></span>

```xml
<ItemGroup>
  <ServiceWorker Include="wwwroot\service-worker.js" 
    PublishedContent="wwwroot\service-worker.published.js" />
</ItemGroup>
```

## <a name="update-no-locrazor-class-libraries-rcls"></a><span data-ttu-id="323f8-240">Aggiornare le Razor librerie di classi (RCL)</span><span class="sxs-lookup"><span data-stu-id="323f8-240">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="323f8-241">Eseguire la migrazione delle Razor librerie di classi (RCL) per sfruttare le nuove API o funzionalità introdotte come parte di ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="323f8-241">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="323f8-242">Per aggiornare un RCL destinato ai componenti:</span><span class="sxs-lookup"><span data-stu-id="323f8-242">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="323f8-243">Aggiornare le proprietà seguenti nel file di progetto:</span><span class="sxs-lookup"><span data-stu-id="323f8-243">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="323f8-244">Aggiornare gli altri pacchetti alle versioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="323f8-244">Update other packages to their latest versions.</span></span> <span data-ttu-id="323f8-245">Le versioni più recenti sono reperibili in [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="323f8-245">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="323f8-246">Per aggiornare un RCL di destinazione MVC, aggiornare le proprietà seguenti nel file di progetto:</span><span class="sxs-lookup"><span data-stu-id="323f8-246">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="323f8-247">Aggiornare i riferimenti del pacchetto</span><span class="sxs-lookup"><span data-stu-id="323f8-247">Update package references</span></span>

<span data-ttu-id="323f8-248">Nel file di progetto aggiornare ogni [Microsoft. AspNetCore. \*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft. EntityFrameworkCore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft. Extensions. \*](https://www.nuget.org/packages?q=Microsoft.Extensions.*)e [System.Net.Http.Jssull'](https://www.nuget.org/packages/System.Net.Http.Json) attributo del riferimento al pacchetto `Version` in 5.0.0 o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="323f8-248">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="323f8-249">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="323f8-249">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="323f8-250">Aggiornare le immagini Docker</span><span class="sxs-lookup"><span data-stu-id="323f8-250">Update Docker images</span></span>

<span data-ttu-id="323f8-251">Per le app che usano Docker, aggiornare le istruzioni e gli script di *Dockerfile* `FROM` .</span><span class="sxs-lookup"><span data-stu-id="323f8-251">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="323f8-252">Usare un'immagine di base che includa il runtime di ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="323f8-252">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="323f8-253">Si consideri la `docker pull` differenza del comando seguente tra ASP.NET Core 3,1 e 5,0:</span><span class="sxs-lookup"><span data-stu-id="323f8-253">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="323f8-254">Come parte del passaggio a ".NET" come nome del prodotto, le immagini Docker sono state spostate dai `mcr.microsoft.com/dotnet/core` repository a `mcr.microsoft.com/dotnet` .</span><span class="sxs-lookup"><span data-stu-id="323f8-254">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="323f8-255">Per altre informazioni, vedere [DotNet/DotNet-Docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span><span class="sxs-lookup"><span data-stu-id="323f8-255">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-no-locrazor-pages"></a><span data-ttu-id="323f8-256">Modifiche dell'associazione di modelli in ASP.NET Core MVC e Razor pagine</span><span class="sxs-lookup"><span data-stu-id="323f8-256">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="323f8-257">I valori DateTime sono associati al modello come ora UTC</span><span class="sxs-lookup"><span data-stu-id="323f8-257">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="323f8-258">In ASP.NET Core 3,1 e versioni precedenti, i `DateTime` valori sono stati associati al modello come ora locale, in cui il fuso orario è stato determinato dal server.</span><span class="sxs-lookup"><span data-stu-id="323f8-258">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="323f8-259">`DateTime` i valori associati da input Formatting (JSON) e `DateTimeOffset` valori sono stati associati come fusi orari UTC.</span><span class="sxs-lookup"><span data-stu-id="323f8-259">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="323f8-260">In ASP.NET Core 5,0 e versioni successive, l'associazione di modelli associa in modo coerente i `DateTime` valori al fuso orario UTC.</span><span class="sxs-lookup"><span data-stu-id="323f8-260">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="323f8-261">Per mantenere il comportamento precedente, rimuovere `DateTimeModelBinderProvider` in `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="323f8-261">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="323f8-262">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder Replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="323f8-262">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="323f8-263">Per aggiungere il supporto per i [tipi di record C# 9](/dotnet/csharp/whats-new/csharp-9#record-types)di associazione di modelli, <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> è:</span><span class="sxs-lookup"><span data-stu-id="323f8-263">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="323f8-264">Annotato come obsoleto.</span><span class="sxs-lookup"><span data-stu-id="323f8-264">Annotated as obsolete.</span></span>
* <span data-ttu-id="323f8-265">Per impostazione predefinita, non è più registrato.</span><span class="sxs-lookup"><span data-stu-id="323f8-265">No longer registered by default.</span></span>

<span data-ttu-id="323f8-266">Per le app che si basano sulla presenza di `ComplexTypeModelBinderProvider` nella `ModelBinderProviders` raccolta è necessario fare riferimento al nuovo provider del gestore di associazione:</span><span class="sxs-lookup"><span data-stu-id="323f8-266">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="usedatabaseerrorpage-obsolete"></a><span data-ttu-id="323f8-267">UseDatabaseErrorPage obsoleto</span><span class="sxs-lookup"><span data-stu-id="323f8-267">UseDatabaseErrorPage obsolete</span></span>

<span data-ttu-id="323f8-268">I modelli ASP.NET Core 3,1 che includono un'opzione per gli account utente singoli generano una chiamata a <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A> .</span><span class="sxs-lookup"><span data-stu-id="323f8-268">The ASP.NET Core 3.1 templates that include an option for individual user accounts generate a call to <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A>.</span></span> <span data-ttu-id="323f8-269">`UseDatabaseErrorPage` è ora obsoleto e deve essere sostituito con una combinazione di `AddDatabaseDeveloperPageExceptionFilter` e `UseMigrationsEndPoint` , come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="323f8-269">`UseDatabaseErrorPage` is now obsolete and should be replaced with a combination of `AddDatabaseDeveloperPageExceptionFilter` and `UseMigrationsEndPoint`, as shown in the following code:</span></span>

```diff
public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContext<ApplicationDbContext>(options =>
        options.UseSqlServer(
            Configuration.GetConnectionString("DefaultConnection")));
+   services.AddDatabaseDeveloperPageExceptionFilter();
    services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount = true)
        .AddEntityFrameworkStores<ApplicationDbContext>();
    services.AddRazorPages();
}

public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
+       app.UseMigrationsEndPoint();
-       app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }
```

<span data-ttu-id="323f8-270">Per altre informazioni, vedere [questo problema di GitHub](https://github.com/dotnet/aspnetcore/issues/24987).</span><span class="sxs-lookup"><span data-stu-id="323f8-270">For more information, see [this GitHub issue](https://github.com/dotnet/aspnetcore/issues/24987).</span></span>

## <a name="review-breaking-changes"></a><span data-ttu-id="323f8-271">Esaminare le modifiche di rilievo</span><span class="sxs-lookup"><span data-stu-id="323f8-271">Review breaking changes</span></span>

<span data-ttu-id="323f8-272">Per le modifiche di rilievo da .NET Core 3,1 a .NET 5,0, vedere [modifiche di rilievo per la migrazione dalla versione 3,1 alla versione 5,0](/dotnet/core/compatibility/3.1-5.0).</span><span class="sxs-lookup"><span data-stu-id="323f8-272">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="323f8-273">Anche ASP.NET Core e Entity Framework Core sono inclusi nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="323f8-273">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>
